---
isChild: true
---

## Data Filtering {#data_filtering_title}

คุณจะต้องไม่เชื่อว่าค่าต่างๆที่ถูกผ่านเข้ามาใน PHP โปรแกรมนั้นมีค่าถูกต้องอย่างเด็ดขาด คุณจะต้องตรวจสอบและแก้ไขข้อมูลเหล่านั้นเสมอก่อนที่จะนำมาใช้ในโปรแกรมของคุณ
ใน PHP นั้นได้มี `filter_var` และ `filter_input` ฟังก์ชั่นที่สามารถตรวจสอบค่าและทำการแก้ไขค่าเหล่านั้นให้ถูกต้องได้ (เช่น ข้อมูล email addresses เป็นต้น)

ข้อมูลที่ได้รับมาจากภายนอกนั้นสามารถเป็นอะไรก็ได้ ข้อมูลเหล่านั้นคือ `$_GET` และ `$_POST` ที่ได้มาจาก form ของคุณ นอกจากนั้น ค่า `$_SERVER` บางค่า และ
HTTP request body จาก `fopen('php://input', 'r')` คุณต้องจำไว้ว่า ข้อมูลภายนอกเหล่านี้ไม่ได้มาจาก form เพียงอย่างเดียวเท่านั้น
การ upload และ download ไฟล์ต่างๆ, ข้อมูลจาก session, ข้อมูล cookie, และ ข้อมูลจากเว็บไซต์ต่างๆนั้นก็ถือว่าเป็นข้อมูลภายนอกทั้งนั้น

โดยข้อมูลภายนอกเหล่านั้น คุณสามารถที่จะนำมาใช้ในโปรแกรมของคุณได้ เราก็ถือว่าข้อมูลเหล่านั้นเป็นข้อมูลที่เราเชื่อถือไม่ได้ ทุกๆครั้งที่เรานำข้อมูลเหล่านั้นมาใช้ไม่ว่าจะนำมาใช้
อย่างไรก็ตามในโปรแกรมของคุณ คุณจะต้องถามตัวคุณเองทุกครั้งว่า คุณสามารถเชื่อถือข้อมูลเหล่านั้นได้หรือไม่ ข้อมูลเหล่านั้นได้รับการตรวจสอบและแก้ไขหรือยัง

ข้อมูลแต่ละข้อมูลนั้นอาจจะมีวิธีการตรวจสอบและแก้ไขที่ต่างกันไปตามจุดประสงค์ที่จะนำมาใช้ ยกตัวอย่างเช่น เมื่อข้อมูลภายนอกที่ไม่ได้รับการตรวจสอบและแก้ไขและได้ถูกนำไปใช้ใน
หน้า HTML นั้น ก็จะสามารถที่จะใช้คำสั่ง HTML และ JavaScript ในหน้าเว็บไซต์ของเราได้ ข้อผิดพลาดนี้เราเรียกว่า Cross-Site Scripting (XSS) attack ซึ่งอันตราย
สำหรับเว็บไซต์ของเราอย่างมาก วิธีการป้องกัน XSS นั้นสามารถทำได้โดยตรวจสอบและแก้ไขค่าภายนอกต่างๆที่เราได้รับมาแล้วถึงนำมาใช้ในโปรแกรมของเรา PHP นั้นได้มีฟังก์ชั่น
ที่สามารถป้องกัน XSS ได้คือ `strip_tags` ที่จะทำการลบ HTML tag ออก หรือ `htmlentities` (หรือ `htmlspecialchars`) ที่จะทำการ escaping characters
ที่มีความหมายพิเศษใน HTML entities ได้

อีกตัวอย่างหนึ่งก็คือ การที่รับข้อมูลภายนอกจาก command line ผ่านทาง options สิ่งนี้ก็ถือเป็นสิ่งที่อันตรายอย่างมาก (และก็ถือว่าเป็นสิ่งที่ไม่สมควรทำ) แต่ถ้าจำเป็นแล้ว
คุณสามารถที่จะใช้ `escapeshellarg` ฟังก์ชั่นในการตรวจสอบและแก้ไขข้อมูลที่ได้รับมาจาก command line ได้

ตัวอย่างสุดท้ายก็คือ การที่เรายอมรับข้อมูลภายนอกเพื่อที่จะหาไฟล์ที่จะนำมาใช้ในระบบไฟล์ของเรา สิ่งนี้ก็ถือว่าเป็นสิ่งที่สามารถก่อให้เกิดอันตรายต่อระบบของเราได้ เพราะถ้า
ข้้อมูลนั้นสามารถที่จะถูกเปลี่ยนจากชื่อไฟล์ให้เป็นไฟล์ path แทนแล้วละก็ ผู้จู่โจมสามารถที่จะหาไฟล์สำคัญต่างๆได้ ดังนั้นคุณจะต้องลบ "/", "../", [null bytes][6]
หรือ characters ต่างๆจากไฟล์ path เพื่อที่จะป้องกันไม่ให้ไฟล์สำคัญต่างๆถูกจู่โจมได้

* [เรียนรู้เกี่ยวกับ data filtering][1]
* [เรียนรู้เกี่ยวกับ `filter_var`][4]
* [เรียนรู้เกี่ยวกับ `filter_input`][5]
* [เรียนรู้เกี่ยวกับการจัดการ null bytes][6]

### Sanitization

Sanitization คือการลบ (หรือที่เรียกว่า escapes) characters ต่างๆที่ไม่ปลอดภัยจากข้อมูลที่ได้รับจากภายนอกโปรแกรมของเรา

ยกตัวอย่างเช่น คุณสมควรที่จะ sanitize ข้อมูลที่ได้รับจากภายนอกโปรแกรมของคุณทุกครั้ง ก่อนที่จะนำข้อมูลเหล่านั้นมาใช้ใน HTML หรือนำไปใช้ใน SQL query ทันที
แต่ถ้าคุณได้ใช้การ bind parameters ด้วย [PDO](#databases) แล้วข้อมูลนั้นก็จะได้ผ่านการตรวจสอบให้คุณก่อนที่จะนำไปใช้ในฐานข้อมูลของคุณได้อย่างปลอดภัย

ในบางครั้งคุณต้องการอนุญาติให้ข้อมูลภายนอกสามารถที่จะส่ง tag ของ HTML บางอย่างที่ปลอดภัยเข้ามาใช้ในโปรแกรมของคุณได้ วิธีนี้เป็นวิธีที่ยากพอสมควร นักพัฒนาส่วนมาก
เลือกที่จะใช้ Markdown หรือ BBCode แทน HTML เพราะว่าจะปลอดภัยกว่าและสะดวกกว่า แต่ถ้าคุณใช้อยากที่จะใช้ HTML ในโปรแกรมของคุณ คุณก็สามารถที่จะใช้
libraries อย่าง [HTML Purifier][html-purifier] และคุณก็สามารถที่จะกำหนดค่า whitelist ต่างๆได้เลย

[อ่านเพิ่มเติมเกี่ยวกับ Sanitization Filters][2]

### Validation

การตรวจสอบข้อมูลนั้นจะใช้กับข้อมูลที่ได้รับจากภายนอกโปรแกรม เพื่อตรวจสอบว่าข้อมูลเหล่านั้นคือสิ่งที่คุณต้องการ ยกตัวอย่างเช่น คุณต้องการที่จะตรวจสอบข้อมูลนั้นซึ่งเป็น
email address, เบอร์โทรศัพท์, หรือ อายุ เป็นต้น เมื่อมีค่าที่ส่งมาจากฟอร์มของคุณ

[อ่านเพิ่มเติม Validation Filters ต่างๆ][3]

[1]: http://www.php.net/manual/en/book.filter.php
[2]: http://www.php.net/manual/en/filter.filters.sanitize.php
[3]: http://www.php.net/manual/en/filter.filters.validate.php
[4]: http://php.net/manual/en/function.filter-var.php
[5]: http://www.php.net/manual/en/function.filter-input.php
[6]: http://php.net/manual/en/security.filesystem.nullbytes.php
[html-purifier]: http://htmlpurifier.org/
